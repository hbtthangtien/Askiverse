@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

@model Application.DTOs.Exam.ExamViewDetailsDTO

@{
	ViewData["Title"] = "Chi tiết bài làm";

	// var correctAnswers = Model.Questions
	//     .SelectMany(q => q.Answers.Where(a => a.IsCorrected == true)
	//         .Select(a => new { QuestionId = q.Id, AnswerId = a.Id }))
	//     .ToList();
}

<div class="container mt-4" style="min-height: 65vh;">
	<h2 class="mb-4">Chi tiết bài làm</h2>

	@foreach (var question in Model.Questions)
	{
		var userAnswer = Model.UserAnswered.FirstOrDefault(x => x.QuestionId == question.Id);
		bool isUserSkipped = userAnswer == null;

		var correctAnswer = question.Answers.FirstOrDefault(a => a.IsCorrected);

		<div class="mb-4 p-3 border rounded @(isUserSkipped ? "bg-warning-subtle" : "bg-light")">
			<h5>
				@question.Content
				@if (isUserSkipped)
				{
					<span class="text-danger fst-italic">(không chọn đáp án)</span>
				}
			</h5>

			<div class="ms-3">
				@foreach (var answer in question.Answers)
				{
					var isUserSelected = userAnswer?.AnswerId == answer.Id;
					var isCorrectAnswer = answer.IsCorrected;
					var icon = "";

					if (userAnswer != null)
					{
						if (isUserSelected)
						{
							if (isCorrectAnswer) icon = "✔️";
							else icon = "❌";
						}
						else
						{
							if (isCorrectAnswer) icon = "✔️";
						}
					}

					<div class="form-check mb-1 p-2 rounded border ">
						<input class="form-check-input"
							   type="radio"
							   disabled
							   name="question-@question.Id"
							   value="@answer.Id"
						@(isUserSelected ? "checked" : "") />

						<label class="form-check-label">
							@answer.AnswerText @icon
						</label>
					</div>
				}
			</div>
		</div>
	}
</div>